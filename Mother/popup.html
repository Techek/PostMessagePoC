<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title></title>
    <script src="Scripts/jquery-3.1.1.js"></script>
</head>
<body>
<h1>Popup Page</h1>
    <iframe id="externalframe" src="http://localhost:18580/index.html" height="300" width="300"></iframe>
<script type="text/javascript">
    // Create IE + others compatible event handler
    var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
    var eventer = window[eventMethod];
    var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

    // Listen to message from child window
    eventer(messageEvent, function(event) {
        if (event.origin !== "http://localhost:18580")
                return;

        window.opener.setObjectId(event.data);
        window.close();
    }, false);

    //window.addEventListener("message", messageReciever, false);
    //function messageReciever(event) {
    //    if (event.origin !== "http://localhost:18580")
    //        return;
    //    window.opener.setObjectId(event.data);
    //}

    var objectId = window.opener.getObjectId();
    console.log("popup", objectId);
    externalframe.onload = function () {
        console.log("popup external onload", objectId);
        if (externalframe.contentWindow) {
            externalframe.contentWindow.postMessage(objectId, "http://localhost:18580");
        } else if (window.frames['externalframe']) {
            window.frames['externalframe'].postMessage(objectId, "http://localhost:18580");
        }
    };
</script>
</body>
</html>